<head>
	<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
	<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest"></script>
</head>
<body>
	<div>Teachable Machine Image Model</div>
	<button type="button" onclick="loadModel()">Load Model</button>
	<button type="button" onclick="openLocalFolder()">Open Local Folder</button>
	<div id="image-container"></div>
	<div id="label-container"></div>

	<script type="text/javascript">
	    let model, labelContainer, maxPredictions;
	    let imageContainer;

	    async function loadModel() {
	        const URL = "./tm-my-image-model/";
	        const modelURL = URL + "model.json";
	        const metadataURL = URL + "metadata.json";

	        model = await tmImage.load(modelURL, metadataURL);
	        maxPredictions = model.getTotalClasses();

	        labelContainer = document.getElementById("label-container");
	        for (let i = 0; i < maxPredictions; i++) {
	            labelContainer.appendChild(document.createElement("div"));
	        }
	    }

	    function openLocalFolder() {
	        // Create an input element
	        const input = document.createElement("input");
	        input.type = "file";
	        input.accept = "image/*";

	        // Add an event listener to handle file selection
	        input.addEventListener("change", handleFileSelection);

	        // Trigger the file selection dialog
	        input.click();
	    }

	    async function handleFileSelection(event) {
	        const files = event.target.files;
	        if (files.length > 0) {
	            const file = files[0];
	            const img = new Image();
	            img.src = URL.createObjectURL(file);

	            img.onload = async function() {
	                showImage(img);
	                await predict(img);
	                URL.revokeObjectURL(img.src);
	            };
	        }
	    }

	    function showImage(image) {
	        // Clear previous image
	        if (imageContainer && imageContainer.firstChild) {
	            imageContainer.removeChild(imageContainer.firstChild);
	        }

	        // Create new image element and append it to the container
	        const imgElement = document.createElement("img");
	        imgElement.src = image.src;
	        imgElement.style.maxWidth = "100%";
	        imgElement.style.height = "auto";

	        imageContainer = document.getElementById("image-container");
	        imageContainer.appendChild(imgElement);
	    }

	    async function predict(image) {
	        const prediction = await model.predict(image);
	        for (let i = 0; i < maxPredictions; i++) {
	            const classPrediction =
	                prediction[i].className + ": " + prediction[i].probability.toFixed(2);
	            labelContainer.childNodes[i].innerHTML = classPrediction;
	        }
	    }
	</script>
</body>
